# ๐๏ธ ููููุฉ ุงููุธุงู - System Architecture

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุตููู ูุฐุง ุงููุธุงู ููู ูุจุฏุฃ **ุงูุนุฒู ุงููุงูู ุจูู ุงูุจูุงูุงุช** ูุถูุงู ุฃุนูู ุฏุฑุฌุงุช ุงูุฃูุงู.

## ๐ ูุจุฏุฃ ุงูุนุฒู (Data Isolation)

### ูุงุนุฏุฉ ุจูุงูุงุช ุงููุตุงุฏูุฉ (Auth Database)
- **ุงููููุน**: `database/authConnection.js`
- **ุงููุญุชูู**: ุจูุงูุงุช ุงููุณุชุฎุฏููู ููุท (users, passwords, roles)
- **ุงููุตูู**: ูุนุฒูู ุชูุงูุงู - ูุง ูููู ุงููุตูู ุฅููู ุฅูุง ูู ุฎูุงู `database/authConnection.js`
- **ุงูุงุณู**: `auth_db`

### ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ (Application Database)
- **ุงููููุน**: `database/appConnection.js`
- **ุงููุญุชูู**: ุจูุงูุงุช ุงูุชุทุจูู (ingredients, recipes, transactions)
- **ุงููุตูู**: ูุนุฒูู ุชูุงูุงู - ูุง ูููู ุงููุตูู ุฅููู ุฅูุง ูู ุฎูุงู `database/appConnection.js`
- **ุงูุงุณู**: `kitchen_inventory`

## ๐ ูููู ุงููุฌูุฏุงุช

```
project/
โโโ config/                    # ุฅุนุฏุงุฏุงุช ุงููุธุงู
โ   โโโ database.js           # ุฅุนุฏุงุฏุงุช ููุงุนุฏ ุงูุจูุงูุงุช
โ   โโโ security.js           # ุฅุนุฏุงุฏุงุช ุงูุฃูุงู
โ
โโโ database/                  # ุงุชุตุงูุงุช ููุงุนุฏ ุงูุจูุงูุงุช (ูุนุฒููุฉ)
โ   โโโ authConnection.js     # ุงุชุตุงู ูุงุนุฏุฉ ุจูุงูุงุช ุงููุตุงุฏูุฉ
โ   โโโ appConnection.js      # ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ
โ
โโโ middleware/                # Middleware ููุฃูุงู
โ   โโโ security.js           # ุงูุชุญูู ูู ุงูุจูุงูุงุช ูุชูุธูููุง
โ
โโโ auth/                      # ูุธุงู ุงููุตุงุฏูุฉ (ูุนุฒูู)
โ   โโโ authController.js     # ูุนุงูุฌุฉ ุงููุตุงุฏูุฉ
โ   โโโ authMiddleware.js     # ุงูุชุญูู ูู ุงูุชููู ูุงูุตูุงุญูุงุช
โ   โโโ authRoutes.js         # ูุณุงุฑุงุช ุงููุตุงุฏูุฉ
โ   โโโ auth_db.sql           # ูุงุนุฏุฉ ุจูุงูุงุช ุงููุตุงุฏูุฉ
โ
โโโ api/                       # ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช
โ   โโโ dashboardController.js
โ   โโโ inventoryController.js
โ   โโโ recipesController.js
โ   โโโ approvalController.js
โ
โโโ server.js                  # ุงูุณูุฑูุฑ ุงูุฑุฆูุณู
```

## ๐ ุงูุฃูุงู

### 1. ุนุฒู ููุงุนุฏ ุงูุจูุงูุงุช
- ูู ูุงุนุฏุฉ ุจูุงูุงุช ููุง ุงุชุตุงู ูููุตู ุชูุงูุงู
- ูุง ูููู ุงููุตูู ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช ุงููุตุงุฏูุฉ ูู API controllers
- ูุง ูููู ุงููุตูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ ูู auth controllers

### 2. ุงูุชุญูู ูู ุงูุจูุงูุงุช (Validation)
- ุฌููุน ุงูุจูุงูุงุช ุงููุงุฑุฏุฉ ูุชู ุชูุธูููุง (Sanitization)
- ุงูุชุญูู ูู ุตุญุฉ ุฃุณูุงุก ุงููุณุชุฎุฏููู ููููุงุช ุงููุฑูุฑ
- ุงูุชุญูู ูู ุงูุฑุชุจ ูุงูุตูุงุญูุงุช

### 3. Middleware ููุฃูุงู
- `sanitizeRequest`: ุชูุธูู ุฌููุน ุงูุจูุงูุงุช ุงููุงุฑุฏุฉ
- `validateLogin`: ุงูุชุญูู ูู ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู
- `validateCreateUser`: ุงูุชุญูู ูู ุจูุงูุงุช ุฅูุดุงุก ุงููุณุชุฎุฏู
- `errorHandler`: ููุน ุชุณุฑูุจ ูุนูููุงุช ุญุณุงุณุฉ ูู ุงูุฃุฎุทุงุก

### 4. ุฅุนุฏุงุฏุงุช ุงูุฃูุงู
- CORS ูุญุฏูุฏ
- Rate Limiting
- JWT ูุน ุงูุชูุงุก ุตูุงุญูุฉ
- ุชุดููุฑ ูููุงุช ุงููุฑูุฑ ุจู bcrypt

## ๐ ุชุฏูู ุงูุจูุงูุงุช

### ุชุณุฌูู ุงูุฏุฎูู
```
Client โ /auth/login โ validateLogin โ authController.login
โ authConnection (auth_db) โ JWT Token โ Client
```

### ุงููุตูู ุฅูู API
```
Client โ API Route โ authMiddleware โ requireRole
โ appConnection (kitchen_inventory) โ Response โ Client
```

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ูุง ุชูู ุจุฅูุดุงุก ุงุชุตุงูุงุช ูุจุงุดุฑุฉ ุจููุงุนุฏ ุงูุจูุงูุงุช** - ุงุณุชุฎุฏู ุงููููุงุช ูู `database/`
2. **ูุง ุชุฎูุท ุจูู ููุงุนุฏ ุงูุจูุงูุงุช** - ุงุณุชุฎุฏู `authConnection` ูููุตุงุฏูุฉ ููุท
3. **ุงุณุชุฎุฏู middleware ููุฃูุงู** - ูุง ุชุซู ุจุงูุจูุงูุงุช ุงููุงุฑุฏุฉ ูู ุงููุณุชุฎุฏู
4. **ุชุญูู ูู ุงูุตูุงุญูุงุช** - ุงุณุชุฎุฏู `requireRole` ูู ุฌููุน ุงููุณุงุฑุงุช ุงูุญุณุงุณุฉ

## ๐ ุงูุจุฏุก

1. ุชุฃูุฏ ูู ูุฌูุฏ ููู `.env` ูุน ุฌููุน ุงููุชุบูุฑุงุช ุงููุทููุจุฉ
2. ุดุบูู `auth/auth_db.sql` ูุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุงููุตุงุฏูุฉ
3. ุดุบูู `init.sql` ูุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ
4. ุดุบูู `node server.js`

## ๐ง ุงูุตูุงูุฉ

- ุฌููุน ุงุชุตุงูุงุช ููุงุนุฏ ุงูุจูุงูุงุช ุชุณุชุฎุฏู Connection Pooling
- ูุชู ุฅุบูุงู ุงูุงุชุตุงูุงุช ุจุดูู ูุธูู ุนูุฏ ุฅููุงู ุงูุณูุฑูุฑ
- ุฌููุน ุงูุฃุฎุทุงุก ูุชู ุชุณุฌูููุง ุจุดูู ุขูู

